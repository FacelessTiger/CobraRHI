#include <ImGuiBackend/imgui_impl_cobra.h>
#include <imgui.h>

#include "shaders/SharedShaderDefs.inl"

#include <array>

// include/ImGuiBackend/shaders/Imgui.slang
static constexpr auto SHADER_SPIRV = std::to_array<uint32_t>({
	0x00000002, 0x00000000, 0x74726576, 0x614d7865, 0x01006e69, 0x70000000, 0x6c657869, 0x6e69614d,
	0x00000000, 0x07230203, 0x00010500, 0x00000028, 0x00000103, 0x00000000, 0x00020011, 0x0000115a, 
	0x00020011, 0x000014e3, 0x00020011, 0x000014b6, 0x00020011, 0x000014b5, 0x00020011, 0x00000001,
	0x0008000a, 0x5f565053, 0x5f52484b, 0x5f6e6f6e, 0x616d6573, 0x6369746e, 0x666e695f, 0x0000006f,
	0x0008000a, 0x5f565053, 0x5f52484b, 0x69726176, 0x656c6261, 0x696f705f, 0x7265746e, 0x00000073, 
	0x0009000a, 0x5f565053, 0x5f52484b, 0x73796870, 0x6c616369, 0x6f74735f, 0x65676172, 0x6675625f,
	0x00726566, 0x000b000b, 0x00000002, 0x536e6f4e, 0x6e616d65, 0x2e636974, 0x64616853, 0x442e7265,
	0x67756265, 0x6f666e49, 0x3030312e, 0x00000000, 0x0003000e, 0x000014e4, 0x00000001, 0x000b000f,
	0x00000000, 0x0000000b, 0x74726576, 0x614d7865, 0x00006e69, 0x00000049, 0x000000c0, 0x000000c3,
	0x000000c7, 0x00000022, 0x000d000f, 0x00000004, 0x000000ca, 0x65786970, 0x69614d6c, 0x0000006e,
	0x00000049, 0x000000ea, 0x000000f4, 0x00000100, 0x000000d5, 0x000000d7, 0x000000da, 0x00030010, 
	0x000000ca, 0x00000007, 0x01180007, 0x00000001, 0x636e6923, 0x6564756c, 0x68532220, 0x64657261,
	0x64616853, 0x65447265, 0x692e7366, 0x0d226c6e, 0x730a0d0a, 0x63757274, 0x65562074, 0x78657472,
	0x7074754f, 0x0a0d7475, 0x200a0d7b, 0x66202020, 0x74616f6c, 0x6f702034, 0x69746973, 0x203a6e6f,
	0x505f5653, 0x7469736f, 0x3b6e6f69, 0x20200a0d, 0x6c662020, 0x3474616f, 0x6c6f6320, 0x0d3b726f,
	0x2020200a, 0x6f6c6620, 0x20327461, 0x0d3b7675, 0x0d3b7d0a, 0x5b0a0d0a, 0x3a3a6b76, 0x68737570,
	0x6e6f635f, 0x6e617473, 0x53205d74, 0x676e616c, 0x72443a3a, 0x75507761, 0x70206873, 0x3b687375, 
	0x0a0d0a0d, 0x3a6b765b, 0x6e69623a, 0x676e6964, 0x202c3028, 0x205d2930, 0x706d6153, 0x5372656c, 
	0x65746174, 0x535f6720, 0x6c706d61, 0x74537265, 0x5b657461, 0x0a0d3b5d, 0x3a6b765b, 0x6e69623a, 
	0x676e6964, 0x202c3228, 0x205d2930, 0x74786554, 0x32657275, 0x6c663c44, 0x3474616f, 0x5f67203e, 
	0x74786554, 0x32657275, 0x6f6c4644, 0x5b347461, 0x0a0d3b5d, 0x6c660a0d, 0x3474616f, 0x706e5520,
	0x556b6361, 0x6d726f6e, 0x28387834, 0x746e6975, 0x6c617620, 0x0d296575, 0x0a0d7b0a, 0x20202020,
	0x746e6975, 0x61702034, 0x64656b63, 0x75203d20, 0x34746e69, 0x6c617628, 0x26206575, 0x66783020,
	0x28202c66, 0x756c6176, 0x3e3e2065, 0x20293820, 0x78302026, 0x202c6666, 0x6c617628, 0x3e206575,
	0x3631203e, 0x20262029, 0x66667830, 0x6176202c, 0x2065756c, 0x32203e3e, 0x0d3b2934, 0x2020200a, 
	0x74657220, 0x206e7275, 0x616f6c66, 0x70283474, 0x656b6361, 0x2f202964, 0x35353220, 0x0d3b302e,
	0x0a0d7d0a, 0x735b0a0d, 0x65646168, 0x76222872, 0x65747265, 0x5d292278, 0x65560a0d, 0x78657472,
	0x7074754f, 0x76207475, 0x65747265, 0x69614d78, 0x6975286e, 0x7620746e, 0x65747265, 0x3a444978,
	0x5f565320, 0x74726556, 0x44497865, 0x7b0a0d29, 0x20200a0d, 0x6c532020, 0x3a676e61, 0x7265563a,
	0x20786574, 0x74726576, 0x3d207865, 0x73757020, 0x65762e68, 0x63697472, 0x765b7365, 0x65747265,
	0x5d444978, 0x200a0d3b, 0x0d202020, 0x2020200a, 0x72655620, 0x4f786574, 0x75707475, 0x756f2074,
	0x74757074, 0x200a0d3b, 0x6f202020, 0x75707475, 0x6f702e74, 0x69746973, 0x3d206e6f, 0x6f6c6620,
	0x28347461, 0x74726576, 0x702e7865, 0x7469736f, 0x206e6f69, 0x7570202a, 0x732e6873, 0x656c6163,
	0x70202b20, 0x2e687375, 0x6e617274, 0x74616c73, 0x30202c65, 0x2931202c, 0x200a0d3b, 0x6f202020,
	0x75707475, 0x6f632e74, 0x20726f6c, 0x6e55203d, 0x6b636170, 0x726f6e55, 0x3878346d, 0x72657628, 
	0x2e786574, 0x6f6c6f63, 0x0d3b2972, 0x2020200a, 0x74756f20, 0x2e747570, 0x3d207675, 0x72657620, 
	0x2e786574, 0x0d3b7675, 0x200a0d0a, 0x2f202020, 0x4148202f, 0x0a0d4b43, 0x20202020, 0x7074756f,
	0x702e7475, 0x7469736f, 0x2e6e6f69, 0x3d2a2079, 0x3b312d20, 0x0a0d0a0d, 0x20202020, 0x75746572,
	0x6f206e72, 0x75707475, 0x0a0d3b74, 0x0d0a0d7d, 0x68735b0a, 0x72656461, 0x69702228, 0x226c6578,
	0x0a0d5d29, 0x616f6c66, 0x70203474, 0x6c657869, 0x6e69614d, 0x72655628, 0x4f786574, 0x75707475, 
	0x65762074, 0x78657472, 0x53203a29, 0x61545f56, 0x74656772, 0x0d7b0a0d, 0x2020200a, 0x74657220, 
	0x206e7275, 0x74726576, 0x632e7865, 0x726f6c6f, 0x67202a20, 0x7865545f, 0x65727574, 0x6c464432, 
	0x3474616f, 0x6e6f4e5b, 0x66696e55, 0x526d726f, 0x756f7365, 0x49656372, 0x7865646e, 0x73757028,
	0x6d692e68, 0x20656761, 0x78302026, 0x66666666, 0x2e5d2966, 0x706d6153, 0x6728656c, 0x6d61535f, 
	0x72656c70, 0x74617453, 0x6f4e5b65, 0x696e556e, 0x6d726f66, 0x6f736552, 0x65637275, 0x65646e49,
	0x75702878, 0x692e6873, 0x6567616d, 0x203e3e20, 0x5d293032, 0x6576202c, 0x78657472, 0x2976752e,
	0x7d0a0d3b, 0x00000000, 0x00130007, 0x00000005, 0x435c3a45, 0x6172626f, 0x5c494852, 0x73706564, 
	0x626f435c, 0x48526172, 0x6e695c49, 0x64756c63, 0x6d495c65, 0x42697547, 0x656b6361, 0x735c646e, 
	0x65646168, 0x495c7372, 0x6975476d, 0x616c732e, 0x0000676e, 0x00030003, 0x0000000b, 0x00000001,
	0x00050007, 0x00000017, 0x74726576, 0x614d7865, 0x00006e69, 0x00040007, 0x0000001c, 0x6e616c73, 
	0x00006367, 0x002e0007, 0x0000001d, 0x7261742d, 0x20746567, 0x72697073, 0x2d202076, 0x63726f66,
	0x6c672d65, 0x732d6c73, 0x616c6163, 0x616c2d72, 0x74756f79, 0x20492d20, 0x2f3a4522, 0x72626f43,
	0x49485261, 0x7065642f, 0x6f432f73, 0x52617262, 0x692f4948, 0x756c636e, 0x20226564, 0x74616d2d,
	0x2d786972, 0x6f79616c, 0x632d7475, 0x6d756c6f, 0x616d2d6e, 0x20726f6a, 0x20304f2d, 0x6b76662d,
	0x6573752d, 0x746e652d, 0x6f707972, 0x2d746e69, 0x656d616e, 0x74732d20, 0x20656761, 0x74726576,
	0x2d207865, 0x72746e65, 0x65762079, 0x78657472, 0x6e69614d, 0x32672d20, 0x00000000, 0x00040007,
	0x00000025, 0x746e6975, 0x00000000, 0x00050007, 0x0000002a, 0x74726576, 0x44497865, 0x00000000,
	0x00040007, 0x00000032, 0x616f6c66, 0x00000074, 0x00050007, 0x00000037, 0x69736f70, 0x6e6f6974, 
	0x00000000, 0x00030007, 0x0000003a, 0x00007675, 0x00040007, 0x0000003c, 0x6f6c6f63, 0x00000072, 
	0x00060007, 0x0000003f, 0x6e616c53, 0x65562e67, 0x78657472, 0x00000000, 0x00040007, 0x00000043, 
	0x74726576, 0x00007865, 0x00060007, 0x00000066, 0x74726556, 0x754f7865, 0x74757074, 0x00000000, 
	0x00040007, 0x00000069, 0x7074756f, 0x00007475, 0x00060007, 0x00000089, 0x61706e55, 0x6e556b63, 
	0x346d726f, 0x00003878, 0x00040007, 0x0000008e, 0x756c6176, 0x00000065, 0x00040007, 0x00000096,
	0x6b636170, 0x00006465, 0x00050007, 0x000000cd, 0x65786970, 0x69614d6c, 0x0000006e, 0x002d0007, 
	0x000000d1, 0x7261742d, 0x20746567, 0x72697073, 0x2d202076, 0x63726f66, 0x6c672d65, 0x732d6c73, 
	0x616c6163, 0x616c2d72, 0x74756f79, 0x20492d20, 0x2f3a4522, 0x72626f43, 0x49485261, 0x7065642f,
	0x6f432f73, 0x52617262, 0x692f4948, 0x756c636e, 0x20226564, 0x74616d2d, 0x2d786972, 0x6f79616c, 
	0x632d7475, 0x6d756c6f, 0x616d2d6e, 0x20726f6a, 0x20304f2d, 0x6b76662d, 0x6573752d, 0x746e652d,
	0x6f707972, 0x2d746e69, 0x656d616e, 0x74732d20, 0x20656761, 0x65786970, 0x652d206c, 0x7972746e, 
	0x78697020, 0x614d6c65, 0x2d206e69, 0x00003267, 0x00060005, 0x0000000e, 0x74726556, 0x754f7865, 
	0x74757074, 0x00000000, 0x00060006, 0x0000000e, 0x00000000, 0x69736f70, 0x6e6f6974, 0x00000000, 
	0x00050006, 0x0000000e, 0x00000001, 0x6f6c6f63, 0x00000072, 0x00040006, 0x0000000e, 0x00000002, 
	0x00007675, 0x00040005, 0x00000013, 0x7074756f, 0x00007475, 0x00040005, 0x00000013, 0x7074756f,
	0x00007475, 0x00050005, 0x00000029, 0x74726576, 0x44497865, 0x00000000, 0x00040005, 0x00000042,
	0x74726576, 0x00007865, 0x00080005, 0x00000045, 0x6e616c53, 0x72442e67, 0x75507761, 0x6e5f6873,
	0x72757461, 0x00006c61, 0x00060006, 0x00000045, 0x00000000, 0x74726576, 0x73656369, 0x00000000,
	0x00050006, 0x00000045, 0x00000001, 0x6c616373, 0x00000065, 0x00060006, 0x00000045, 0x00000002, 
	0x6e617274, 0x74616c73, 0x00000065, 0x00050006, 0x00000045, 0x00000003, 0x67616d69, 0x00000065, 
	0x00040005, 0x00000049, 0x68737570, 0x00000000, 0x00080005, 0x00000046, 0x6e616c53, 0x65562e67, 
	0x78657472, 0x74616e5f, 0x6c617275, 0x00000000, 0x00060006, 0x00000046, 0x00000000, 0x69736f70,
	0x6e6f6974, 0x00000000, 0x00040006, 0x00000046, 0x00000001, 0x00007675, 0x00050006, 0x00000046, 
	0x00000002, 0x6f6c6f63, 0x00000072, 0x00040005, 0x0000004f, 0x74726576, 0x00007865, 0x00060005,
	0x00000050, 0x6e616c53, 0x65562e67, 0x78657472, 0x00000000, 0x00060006, 0x00000050, 0x00000000, 
	0x69736f70, 0x6e6f6974, 0x00000000, 0x00040006, 0x00000050, 0x00000001, 0x00007675, 0x00050006,
	0x00000050, 0x00000002, 0x6f6c6f63, 0x00000072, 0x00060005, 0x00000052, 0x61706e75, 0x74536b63, 
	0x6761726f, 0x00000065, 0x00040005, 0x00000068, 0x7074756f, 0x00007475, 0x00040005, 0x00000085, 
	0x756c6176, 0x00000065, 0x00040005, 0x0000008d, 0x756c6176, 0x00000065, 0x00040005, 0x00000095, 
	0x6b636170, 0x00006465, 0x00040005, 0x000000a2, 0x6b636170, 0x00006465, 0x00060005, 0x00000083, 
	0x61706e55, 0x6e556b63, 0x346d726f, 0x00003878, 0x000b0005, 0x000000c3, 0x72746e65, 0x696f5079,
	0x6150746e, 0x5f6d6172, 0x74726576, 0x614d7865, 0x632e6e69, 0x726f6c6f, 0x00000000, 0x000a0005, 
	0x000000c7, 0x72746e65, 0x696f5079, 0x6150746e, 0x5f6d6172, 0x74726576, 0x614d7865, 0x752e6e69, 
	0x00000076, 0x00050005, 0x0000000b, 0x74726576, 0x614d7865, 0x00006e69, 0x00060005, 0x000000d7, 
	0x74726576, 0x632e7865, 0x726f6c6f, 0x00000000, 0x00050005, 0x000000da, 0x74726576, 0x752e7865, 
	0x00000076, 0x00040005, 0x000000dc, 0x74726576, 0x00007865, 0x00070005, 0x000000ea, 0x65545f67, 
	0x72757478, 0x46443265, 0x74616f6c, 0x00000034, 0x00060005, 0x000000f4, 0x61535f67, 0x656c706d,
	0x61745372, 0x00006574, 0x00060005, 0x000000fb, 0x706d6173, 0x4964656c, 0x6567616d, 0x00000000, 
	0x00040005, 0x000000fc, 0x706d6173, 0x0064656c, 0x00090005, 0x00000100, 0x72746e65, 0x696f5079, 
	0x6150746e, 0x5f6d6172, 0x65786970, 0x69614d6c, 0x0000006e, 0x00050005, 0x000000ca, 0x65786970,
	0x69614d6c, 0x0000006e, 0x00050048, 0x0000000e, 0x00000000, 0x00000023, 0x00000000, 0x00050048,
	0x0000000e, 0x00000001, 0x00000023, 0x00000010, 0x00050048, 0x0000000e, 0x00000002, 0x00000023,
	0x00000020, 0x00040047, 0x00000022, 0x0000000b, 0x0000002a, 0x00040047, 0x00000047, 0x00000006, 
	0x00000014, 0x00030047, 0x00000045, 0x00000002, 0x00050048, 0x00000045, 0x00000000, 0x00000023, 
	0x00000000, 0x00050048, 0x00000045, 0x00000001, 0x00000023, 0x00000008, 0x00050048, 0x00000045, 
	0x00000002, 0x00000023, 0x00000010, 0x00050048, 0x00000045, 0x00000003, 0x00000023, 0x00000018, 
	0x00050048, 0x00000046, 0x00000000, 0x00000023, 0x00000000, 0x00050048, 0x00000046, 0x00000001,
	0x00000023, 0x00000008, 0x00050048, 0x00000046, 0x00000002, 0x00000023, 0x00000010, 0x00050048, 
	0x00000050, 0x00000000, 0x00000023, 0x00000000, 0x00050048, 0x00000050, 0x00000001, 0x00000023,
	0x00000008, 0x00050048, 0x00000050, 0x00000002, 0x00000023, 0x00000010, 0x00040047, 0x000000c0,
	0x0000000b, 0x00000000, 0x00040047, 0x000000c3, 0x0000001e, 0x00000000, 0x00040047, 0x000000c7,
	0x0000001e, 0x00000001, 0x00040047, 0x000000d5, 0x0000000b, 0x0000000f, 0x00040047, 0x000000d7,
	0x0000001e, 0x00000000, 0x00040047, 0x000000da, 0x0000001e, 0x00000001, 0x00040047, 0x000000e7,
	0x00000006, 0x00000008, 0x00040047, 0x000000ea, 0x00000021, 0x00000002, 0x00040047, 0x000000ea,
	0x00000022, 0x00000000, 0x00030047, 0x000000ed, 0x000014b4, 0x00040047, 0x000000f1, 0x00000006, 
	0x00000008, 0x00040047, 0x000000f4, 0x00000021, 0x00000000, 0x00040047, 0x000000f4, 0x00000022,
	0x00000000, 0x00030047, 0x000000f7, 0x000014b4, 0x00030047, 0x000000f8, 0x000014b4, 0x00040047,
	0x00000100, 0x0000001e, 0x00000000, 0x00020013, 0x00000003, 0x0007000c, 0x00000003, 0x00000004,
	0x00000002, 0x00000023, 0x00000005, 0x00000001, 0x00040015, 0x00000006, 0x00000020, 0x00000000, 
	0x0004002b, 0x00000006, 0x00000007, 0x0000000b, 0x0004002b, 0x00000006, 0x00000008, 0x00000005, 
	0x0004002b, 0x00000006, 0x00000009, 0x00000064, 0x0009000c, 0x00000003, 0x0000000a, 0x00000002, 
	0x00000001, 0x00000009, 0x00000008, 0x00000004, 0x00000007, 0x00030021, 0x0000000c, 0x00000003, 
	0x00030016, 0x0000000f, 0x00000020, 0x00040017, 0x00000010, 0x0000000f, 0x00000004, 0x00040017, 
	0x00000011, 0x0000000f, 0x00000002, 0x0005001e, 0x0000000e, 0x00000010, 0x00000010, 0x00000011, 
	0x00040020, 0x00000012, 0x00000007, 0x0000000e, 0x0004002b, 0x00000006, 0x00000015, 0x00000000, 
	0x0007000c, 0x00000003, 0x00000014, 0x00000002, 0x00000008, 0x00000015, 0x00000003, 0x0004002b, 
	0x00000006, 0x00000018, 0x00000016, 0x0004002b, 0x00000006, 0x00000019, 0x0000000e, 0x000e000c, 
	0x00000003, 0x00000016, 0x00000002, 0x00000014, 0x00000017, 0x00000014, 0x00000004, 0x00000018, 
	0x00000019, 0x0000000a, 0x00000017, 0x00000015, 0x00000018, 0x0009000c, 0x00000003, 0x0000001b, 
	0x00000002, 0x0000006b, 0x00000016, 0x0000000a, 0x0000001c, 0x0000001d, 0x00040015, 0x0000001f, 
	0x00000020, 0x00000001, 0x00040020, 0x00000021, 0x00000001, 0x0000001f, 0x0004002b, 0x00000006, 
	0x00000026, 0x00000020, 0x0004002b, 0x00000006, 0x00000027, 0x00000006, 0x0004002b, 0x00000006, 
	0x00000028, 0x00020000, 0x0009000c, 0x00000003, 0x00000024, 0x00000002, 0x00000002, 0x00000025, 
	0x00000026, 0x00000027, 0x00000028, 0x000d000c, 0x00000003, 0x00000029, 0x00000002, 0x0000001a, 
	0x0000002a, 0x00000024, 0x00000004, 0x00000018, 0x00000019, 0x00000016, 0x00000015, 0x00000015,
	0x0005000c, 0x00000003, 0x0000002b, 0x00000002, 0x0000001f, 0x0004002b, 0x00000006, 0x0000002e, 
	0x00000018, 0x0004002b, 0x00000006, 0x00000033, 0x00000003, 0x0009000c, 0x00000003, 0x00000031, 
	0x00000002, 0x00000002, 0x00000032, 0x00000026, 0x00000033, 0x00000028, 0x0004002b, 0x00000006, 
	0x00000035, 0x00000002, 0x0007000c, 0x00000003, 0x00000034, 0x00000002, 0x00000006, 0x00000031, 
	0x00000035, 0x0004002b, 0x00000006, 0x00000038, 0x00000040, 0x000d000c, 0x00000003, 0x00000036, 
	0x00000002, 0x0000000b, 0x00000037, 0x00000034, 0x00000004, 0x00000015, 0x00000015, 0x00000015, 
	0x00000038, 0x00000015, 0x000d000c, 0x00000003, 0x00000039, 0x00000002, 0x0000000b, 0x0000003a, 
	0x00000034, 0x00000004, 0x00000015, 0x00000015, 0x00000038, 0x00000038, 0x00000015, 0x0004002b, 
	0x00000006, 0x0000003d, 0x00000080, 0x000d000c, 0x00000003, 0x0000003b, 0x00000002, 0x0000000b, 
	0x0000003c, 0x00000024, 0x00000004, 0x00000015, 0x00000015, 0x0000003d, 0x00000026, 0x00000015, 
	0x0004002b, 0x00000006, 0x00000040, 0x00000001, 0x0004002b, 0x00000006, 0x00000041, 0x000000a0,
	0x0011000c, 0x00000003, 0x0000003e, 0x00000002, 0x0000000a, 0x0000003f, 0x00000040, 0x00000004, 
	0x00000015, 0x00000015, 0x0000000a, 0x0000003f, 0x00000041, 0x00000028, 0x00000036, 0x00000039,
	0x0000003b, 0x0004002b, 0x00000006, 0x00000044, 0x00000013, 0x000c000c, 0x00000003, 0x00000042,
	0x00000002, 0x0000001a, 0x00000043, 0x0000003e, 0x00000004, 0x0000002e, 0x00000044, 0x00000016, 
	0x00000015, 0x00030027, 0x00000047, 0x000014e5, 0x0006001e, 0x00000045, 0x00000047, 0x00000011,
	0x00000011, 0x00000006, 0x00040020, 0x00000048, 0x00000009, 0x00000045, 0x0004002b, 0x0000001f,
	0x0000004a, 0x00000000, 0x00040020, 0x0000004b, 0x00000009, 0x00000047, 0x0005001e, 0x00000046,
	0x00000011, 0x00000011, 0x00000006, 0x0005001e, 0x00000050, 0x00000011, 0x00000011, 0x00000006,
	0x00040021, 0x00000053, 0x00000050, 0x00000046, 0x0004002b, 0x00000006, 0x0000005d, 0x0000001a,
	0x0004002b, 0x00000006, 0x0000005f, 0x00000004, 0x0007000c, 0x00000003, 0x0000005e, 0x00000002,
	0x00000006, 0x00000031, 0x0000005f, 0x0004002b, 0x00000006, 0x00000061, 0x00000008, 0x000d000c,
	0x00000003, 0x00000060, 0x00000002, 0x0000000b, 0x00000037, 0x0000005e, 0x00000004, 0x00000033, 
	0x00000061, 0x00000015, 0x0000003d, 0x00000015, 0x000d000c, 0x00000003, 0x00000062, 0x00000002,
	0x0000000b, 0x0000003c, 0x0000005e, 0x00000004, 0x00000033, 0x00000061, 0x0000003d, 0x0000003d, 
	0x00000015, 0x0004002b, 0x00000006, 0x00000064, 0x00000100, 0x000d000c, 0x00000003, 0x00000063,
	0x00000002, 0x0000000b, 0x0000003a, 0x00000034, 0x00000004, 0x00000033, 0x00000061, 0x00000064,
	0x00000038, 0x00000015, 0x0004002b, 0x00000006, 0x00000067, 0x00000140, 0x0011000c, 0x00000003, 
	0x00000065, 0x00000002, 0x0000000a, 0x00000066, 0x00000040, 0x00000004, 0x00000033, 0x00000061, 
	0x0000000a, 0x00000066, 0x00000067, 0x00000028, 0x00000060, 0x00000062, 0x00000063, 0x0004002b, 
	0x00000006, 0x0000006a, 0x00000012, 0x000c000c, 0x00000003, 0x00000068, 0x00000002, 0x0000001a, 
	0x00000069, 0x00000065, 0x00000004, 0x0000005d, 0x0000006a, 0x00000016, 0x00000015, 0x0004002b, 
	0x00000006, 0x0000006c, 0x0000001b, 0x00040020, 0x0000006d, 0x00000007, 0x00000010, 0x0004002b, 
	0x0000001f, 0x00000070, 0x00000001, 0x00040020, 0x00000071, 0x00000009, 0x00000011, 0x0004002b, 
	0x0000001f, 0x00000075, 0x00000002, 0x0004002b, 0x0000000f, 0x0000007a, 0x00000000, 0x0004002b, 
	0x0000000f, 0x0000007b, 0x3f800000, 0x0004002b, 0x00000006, 0x0000007f, 0x0000001c, 0x00040021, 
	0x00000084, 0x00000010, 0x00000006, 0x0007000c, 0x00000003, 0x00000087, 0x00000002, 0x00000008, 
	0x00000015, 0x00000003, 0x0004002b, 0x00000006, 0x0000008a, 0x0000000f, 0x000e000c, 0x00000003, 
	0x00000088, 0x00000002, 0x00000014, 0x00000089, 0x00000087, 0x00000004, 0x0000008a, 0x00000061,
	0x0000000a, 0x00000089, 0x00000015, 0x0000008a, 0x000d000c, 0x00000003, 0x0000008d, 0x00000002,
	0x0000001a, 0x0000008e, 0x00000024, 0x00000004, 0x0000008a, 0x00000061, 0x00000088, 0x00000015, 
	0x00000015, 0x0004002b, 0x00000006, 0x00000091, 0x00000011, 0x0007000c, 0x00000003, 0x00000094, 
	0x00000002, 0x00000006, 0x00000024, 0x0000005f, 0x000c000c, 0x00000003, 0x00000095, 0x00000002, 
	0x0000001a, 0x00000096, 0x00000094, 0x00000004, 0x00000091, 0x00000007, 0x00000088, 0x00000015,
	0x0004002b, 0x00000006, 0x00000098, 0x000000ff, 0x0004002b, 0x0000001f, 0x0000009a, 0x00000008, 
	0x0004002b, 0x0000001f, 0x0000009d, 0x00000010, 0x0004002b, 0x0000001f, 0x000000a0, 0x00000018, 
	0x00040017, 0x000000a1, 0x00000006, 0x00000004, 0x0004002b, 0x0000000f, 0x000000a7, 0x437f0000, 
	0x0004002b, 0x00000006, 0x000000ad, 0x0000001d, 0x00040020, 0x000000ae, 0x00000007, 0x00000011, 
	0x00040020, 0x000000b4, 0x00000007, 0x0000000f, 0x0004002b, 0x0000000f, 0x000000b8, 0xbf800000, 
	0x0004002b, 0x00000006, 0x000000bc, 0x00000022, 0x00040020, 0x000000bf, 0x00000003, 0x00000010,
	0x00040020, 0x000000c6, 0x00000003, 0x00000011, 0x0004002b, 0x00000006, 0x000000ce, 0x00000026,
	0x000e000c, 0x00000003, 0x000000cc, 0x00000002, 0x00000014, 0x000000cd, 0x00000014, 0x00000004,
	0x000000ce, 0x00000061, 0x0000000a, 0x000000cd, 0x00000015, 0x000000ce, 0x0009000c, 0x00000003,
	0x000000d0, 0x00000002, 0x0000006b, 0x000000cc, 0x0000000a, 0x0000001c, 0x000000d1, 0x00040020, 
	0x000000d4, 0x00000001, 0x00000010, 0x00040020, 0x000000d9, 0x00000001, 0x00000011, 0x000d000c, 
	0x00000003, 0x000000dc, 0x00000002, 0x0000001a, 0x00000043, 0x00000065, 0x00000004, 0x000000ce, 
	0x00000061, 0x000000cc, 0x00000015, 0x00000015, 0x0004002b, 0x00000006, 0x000000df, 0x00000028, 
	0x0004002b, 0x0000001f, 0x000000e1, 0x00000003, 0x00040020, 0x000000e2, 0x00000009, 0x00000006, 
	0x0004002b, 0x00000006, 0x000000e6, 0x000fffff, 0x00090019, 0x000000e8, 0x0000000f, 0x00000001, 
	0x00000002, 0x00000000, 0x00000000, 0x00000001, 0x00000000, 0x0003001d, 0x000000e7, 0x000000e8, 
	0x00040020, 0x000000e9, 0x00000000, 0x000000e7, 0x00040020, 0x000000eb, 0x00000000, 0x000000e8, 
	0x0004002b, 0x0000001f, 0x000000f0, 0x00000014, 0x0002001a, 0x000000f2, 0x0003001d, 0x000000f1, 
	0x000000f2, 0x00040020, 0x000000f3, 0x00000000, 0x000000f1, 0x00040020, 0x000000f5, 0x00000000,
	0x000000f2, 0x0003001b, 0x000000fa, 0x000000e8, 0x00040020, 0x00000047, 0x000014e5, 0x00000046,
	0x0004003b, 0x00000021, 0x00000022, 0x00000001, 0x0004003b, 0x00000048, 0x00000049, 0x00000009, 
	0x0004003b, 0x000000bf, 0x000000c0, 0x00000003, 0x0004003b, 0x000000bf, 0x000000c3, 0x00000003,
	0x0004003b, 0x000000c6, 0x000000c7, 0x00000003, 0x0004003b, 0x000000d4, 0x000000d5, 0x00000001, 
	0x0004003b, 0x000000d4, 0x000000d7, 0x00000001, 0x0004003b, 0x000000d9, 0x000000da, 0x00000001, 
	0x0004003b, 0x000000e9, 0x000000ea, 0x00000000, 0x0004003b, 0x000000f3, 0x000000f4, 0x00000000, 
	0x0004003b, 0x000000bf, 0x00000100, 0x00000003, 0x00050036, 0x00000003, 0x0000000b, 0x00000000,
	0x0000000c, 0x000200f8, 0x0000000d, 0x0004003b, 0x00000012, 0x00000013, 0x00000007, 0x0007000c, 
	0x00000003, 0x0000001a, 0x00000002, 0x00000065, 0x00000016, 0x0000000b, 0x0006000c, 0x00000003, 
	0x0000001e, 0x00000002, 0x00000017, 0x00000016, 0x0004003d, 0x0000001f, 0x00000020, 0x00000022, 
	0x0004007c, 0x00000006, 0x00000023, 0x00000020, 0x0008000c, 0x00000003, 0x0000002c, 0x00000002,
	0x0000001d, 0x00000029, 0x00000023, 0x0000002b, 0x000a000c, 0x00000003, 0x0000002d, 0x00000002, 
	0x00000067, 0x00000004, 0x0000002e, 0x0000002e, 0x00000008, 0x00000027, 0x000a000c, 0x00000003, 
	0x0000002f, 0x00000002, 0x00000067, 0x00000004, 0x0000002e, 0x0000002e, 0x00000008, 0x00000027, 
	0x000a000c, 0x00000003, 0x00000030, 0x00000002, 0x00000067, 0x00000004, 0x0000002e, 0x0000002e, 
	0x00000008, 0x00000027, 0x00050041, 0x0000004b, 0x0000004c, 0x00000049, 0x0000004a, 0x0004003d,
	0x00000047, 0x0000004d, 0x0000004c, 0x00050043, 0x00000047, 0x0000004e, 0x0000004d, 0x00000023,
	0x0006003d, 0x00000046, 0x0000004f, 0x0000004e, 0x00000002, 0x00000004, 0x00050039, 0x00000050, 
	0x00000051, 0x00000052, 0x0000004f, 0x0008000c, 0x00000003, 0x0000005b, 0x00000002, 0x0000001d, 
	0x00000042, 0x00000051, 0x0000002b, 0x000a000c, 0x00000003, 0x0000005c, 0x00000002, 0x00000067, 
	0x00000004, 0x0000005d, 0x0000005d, 0x00000008, 0x00000027, 0x000a000c, 0x00000003, 0x0000006b, 
	0x00000002, 0x00000067, 0x00000004, 0x0000006c, 0x0000006c, 0x00000008, 0x00000027, 0x00050041, 
	0x0000006d, 0x0000006e, 0x00000013, 0x0000004a, 0x00050051, 0x00000011, 0x0000006f, 0x00000051, 
	0x00000000, 0x00050041, 0x00000071, 0x00000072, 0x00000049, 0x00000070, 0x0004003d, 0x00000011,
	0x00000073, 0x00000072, 0x00050085, 0x00000011, 0x00000074, 0x0000006f, 0x00000073, 0x00050041,
	0x00000071, 0x00000076, 0x00000049, 0x00000075, 0x0004003d, 0x00000011, 0x00000077, 0x00000076,
	0x00050081, 0x00000011, 0x00000078, 0x00000074, 0x00000077, 0x00060050, 0x00000010, 0x00000079, 
	0x00000078, 0x0000007a, 0x0000007b, 0x0003003e, 0x0000006e, 0x00000079, 0x0009000c, 0x00000003,
	0x0000007d, 0x00000002, 0x0000001d, 0x00000068, 0x00000079, 0x0000002b, 0x0000004a, 0x000a000c,
	0x00000003, 0x0000007e, 0x00000002, 0x00000067, 0x00000004, 0x0000007f, 0x0000007f, 0x00000008,
	0x00000027, 0x00050041, 0x0000006d, 0x00000080, 0x00000013, 0x00000070, 0x00050051, 0x00000006,
	0x00000081, 0x00000051, 0x00000002, 0x00050039, 0x00000010, 0x00000082, 0x00000083, 0x00000081, 
	0x0003003e, 0x00000080, 0x00000082, 0x0009000c, 0x00000003, 0x000000ab, 0x00000002, 0x0000001d, 
	0x00000068, 0x00000082, 0x0000002b, 0x00000070, 0x000a000c, 0x00000003, 0x000000ac, 0x00000002,
	0x00000067, 0x00000004, 0x000000ad, 0x000000ad, 0x00000008, 0x00000027, 0x00050041, 0x000000ae,
	0x000000af, 0x00000013, 0x00000075, 0x00050051, 0x00000011, 0x000000b0, 0x00000051, 0x00000001,
	0x0003003e, 0x000000af, 0x000000b0, 0x0009000c, 0x00000003, 0x000000b2, 0x00000002, 0x0000001d, 
	0x00000068, 0x000000b0, 0x0000002b, 0x00000075, 0x000a000c, 0x00000003, 0x000000b3, 0x00000002,
	0x00000067, 0x00000004, 0x00000026, 0x00000026, 0x00000008, 0x00000027, 0x00050041, 0x000000b4,
	0x000000b5, 0x0000006e, 0x00000070, 0x0004003d, 0x0000000f, 0x000000b6, 0x000000b5, 0x00050085,
	0x0000000f, 0x000000b7, 0x000000b6, 0x000000b8, 0x0003003e, 0x000000b5, 0x000000b7, 0x000a000c, 
	0x00000003, 0x000000ba, 0x00000002, 0x0000001d, 0x00000068, 0x000000b7, 0x0000002b, 0x0000004a, 
	0x00000070, 0x000a000c, 0x00000003, 0x000000bb, 0x00000002, 0x00000067, 0x00000004, 0x000000bc,
	0x000000bc, 0x00000008, 0x00000027, 0x0004003d, 0x0000000e, 0x000000bd, 0x00000013, 0x00050051,
	0x00000010, 0x000000be, 0x000000bd, 0x00000000, 0x0003003e, 0x000000c0, 0x000000be, 0x00050051,
	0x00000010, 0x000000c2, 0x000000bd, 0x00000001, 0x0003003e, 0x000000c3, 0x000000c2, 0x00050051,
	0x00000011, 0x000000c5, 0x000000bd, 0x00000002, 0x0003003e, 0x000000c7, 0x000000c5, 0x000100fd,
	0x00010038, 0x00050036, 0x00000050, 0x00000052, 0x00000000, 0x00000053, 0x00030037, 0x00000046,
	0x00000054, 0x000200f8, 0x00000055, 0x00050051, 0x00000011, 0x00000056, 0x00000054, 0x00000000, 
	0x00050051, 0x00000011, 0x00000057, 0x00000054, 0x00000001, 0x00050051, 0x00000006, 0x00000058, 
	0x00000054, 0x00000002, 0x00060050, 0x00000050, 0x00000059, 0x00000056, 0x00000057, 0x00000058,
	0x000200fe, 0x00000059, 0x00010038, 0x00050036, 0x00000010, 0x00000083, 0x00000000, 0x00000084,
	0x00030037, 0x00000006, 0x00000085, 0x000200f8, 0x00000086, 0x0007000c, 0x00000003, 0x0000008b,
	0x00000002, 0x00000065, 0x00000088, 0x00000083, 0x0006000c, 0x00000003, 0x0000008c, 0x00000002, 
	0x00000017, 0x00000088, 0x0008000c, 0x00000003, 0x0000008f, 0x00000002, 0x0000001d, 0x0000008d, 
	0x00000085, 0x0000002b, 0x000a000c, 0x00000003, 0x00000090, 0x00000002, 0x00000067, 0x00000004,
	0x00000091, 0x00000091, 0x00000008, 0x00000027, 0x000a000c, 0x00000003, 0x00000092, 0x00000002,
	0x00000067, 0x00000004, 0x00000091, 0x00000091, 0x00000008, 0x00000027, 0x000a000c, 0x00000003,
	0x00000093, 0x00000002, 0x00000067, 0x00000004, 0x00000091, 0x00000091, 0x00000008, 0x00000027, 
	0x000500c7, 0x00000006, 0x00000097, 0x00000085, 0x00000098, 0x000500c2, 0x00000006, 0x00000099, 
	0x00000085, 0x0000009a, 0x000500c7, 0x00000006, 0x0000009b, 0x00000099, 0x00000098, 0x000500c2,
	0x00000006, 0x0000009c, 0x00000085, 0x0000009d, 0x000500c7, 0x00000006, 0x0000009e, 0x0000009c, 
	0x00000098, 0x000500c2, 0x00000006, 0x0000009f, 0x00000085, 0x000000a0, 0x00070050, 0x000000a1, 
	0x000000a2, 0x00000097, 0x0000009b, 0x0000009e, 0x0000009f, 0x0008000c, 0x00000003, 0x000000a3, 
	0x00000002, 0x0000001d, 0x00000095, 0x000000a2, 0x0000002b, 0x000a000c, 0x00000003, 0x000000a4, 
	0x00000002, 0x00000067, 0x00000004, 0x0000006a, 0x0000006a, 0x00000008, 0x00000027, 0x00040070, 
	0x00000010, 0x000000a5, 0x000000a2, 0x00070050, 0x00000010, 0x000000a6, 0x000000a7, 0x000000a7,
	0x000000a7, 0x000000a7, 0x00050088, 0x00000010, 0x000000a8, 0x000000a5, 0x000000a6, 0x000200fe, 
	0x000000a8, 0x00010038, 0x00050036, 0x00000003, 0x000000ca, 0x00000000, 0x0000000c, 0x000200f8, 
	0x000000cb, 0x0007000c, 0x00000003, 0x000000cf, 0x00000002, 0x00000065, 0x000000cc, 0x000000ca, 
	0x0006000c, 0x00000003, 0x000000d2, 0x00000002, 0x00000017, 0x000000cc, 0x0004003d, 0x00000010,
	0x000000d3, 0x000000d5, 0x0004003d, 0x00000010, 0x000000d6, 0x000000d7, 0x0004003d, 0x00000011,
	0x000000d8, 0x000000da, 0x00060050, 0x0000000e, 0x000000db, 0x000000d3, 0x000000d6, 0x000000d8, 
	0x0008000c, 0x00000003, 0x000000dd, 0x00000002, 0x0000001d, 0x000000dc, 0x000000db, 0x0000002b, 
	0x000a000c, 0x00000003, 0x000000de, 0x00000002, 0x00000067, 0x00000004, 0x000000df, 0x000000df, 
	0x00000008, 0x00000027, 0x000a000c, 0x00000003, 0x000000e0, 0x00000002, 0x00000067, 0x00000004,
	0x000000df, 0x000000df, 0x00000008, 0x00000027, 0x00050041, 0x000000e2, 0x000000e3, 0x00000049, 
	0x000000e1, 0x0004003d, 0x00000006, 0x000000e4, 0x000000e3, 0x000500c7, 0x00000006, 0x000000e5,
	0x000000e4, 0x000000e6, 0x00050041, 0x000000eb, 0x000000ec, 0x000000ea, 0x000000e5, 0x0004003d,
	0x000000e8, 0x000000ed, 0x000000ec, 0x0004003d, 0x00000006, 0x000000ee, 0x000000e3, 0x000500c2,
	0x00000006, 0x000000ef, 0x000000ee, 0x000000f0, 0x00050041, 0x000000f5, 0x000000f6, 0x000000f4, 
	0x000000ef, 0x0004003d, 0x000000e8, 0x000000f7, 0x000000ec, 0x0004003d, 0x000000f2, 0x000000f8,
	0x000000f6, 0x0004003d, 0x00000011, 0x000000f9, 0x000000da, 0x00050056, 0x000000fa, 0x000000fb, 
	0x000000f7, 0x000000f8, 0x00060057, 0x00000010, 0x000000fc, 0x000000fb, 0x000000f9, 0x00000000, 
	0x00040053, 0x00000010, 0x000000fd, 0x000000fc, 0x0004003d, 0x00000010, 0x000000fe, 0x000000d7, 
	0x00050085, 0x00000010, 0x000000ff, 0x000000fe, 0x000000fd, 0x0003003e, 0x00000100, 0x000000ff,
	0x000100fd, 0x00010038
});

struct ImGui_ImplCobra_FrameRenderBuffers
{
	std::unique_ptr<Cobra::Buffer> VertexBuffer = nullptr;
	std::unique_ptr<Cobra::Buffer> IndexBuffer = nullptr;
};

struct ImGui_ImplCobra_WindowRenderBuffers
{
	uint32_t Index;
	uint32_t Count;
	std::vector<ImGui_ImplCobra_FrameRenderBuffers> FrameRenderBuffers;
};

struct ImGui_ImplCobraH_Window
{
	std::unique_ptr<Cobra::Swapchain> Swapchain;
	Cobra::SyncPoint SyncPoint[2];

	uint32_t FrameIndex = 0;
	bool ClearEnable;
};

struct ImGui_ImplCobra_ViewportData
{
	ImGui_ImplCobraH_Window Window; // Used by secondary viewports only
	ImGui_ImplCobra_WindowRenderBuffers RenderBuffers; // Used by all viewports
	bool WindowOwned = false;

	ImGui_ImplCobra_ViewportData() { memset(&RenderBuffers, 0, sizeof(RenderBuffers)); }
};

struct ImGui_ImplCobra_Data
{
	ImGui_ImplCobra_InitInfo CobraInitInfo;

	std::unique_ptr<Cobra::Sampler> FontSampler;
	std::unique_ptr<Cobra::Image> FontImage;
	std::unique_ptr<Cobra::Shader> Shader;
};

static ImGui_ImplCobra_Data* ImGui_ImplCobra_GetBackendData()
{
	return ImGui::GetCurrentContext() ? (ImGui_ImplCobra_Data*)ImGui::GetIO().BackendRendererUserData : nullptr;
}

static void ImGui_ImplCobra_CreateWindow(ImGuiViewport* viewport)
{
	ImGui_ImplCobra_Data* bd = ImGui_ImplCobra_GetBackendData();
	ImGui_ImplCobra_ViewportData* vd = IM_NEW(ImGui_ImplCobra_ViewportData)();
	viewport->RendererUserData = vd;
	ImGui_ImplCobraH_Window* wd = &vd->Window;
	ImGui_ImplCobra_InitInfo* v = &bd->CobraInitInfo;

	wd->Swapchain = std::make_unique<Cobra::Swapchain>(*v->Context, Platform_GetNativeWindow(viewport), Cobra::uVec2{(uint32_t)viewport->Size.x, (uint32_t)viewport->Size.y}, false);
	wd->ClearEnable = (viewport->Flags & ImGuiViewportFlags_NoRendererClear) ? false : true;
	vd->WindowOwned = true;
}

static void ImGui_ImplCobra_DestroyWindow(ImGuiViewport* viewport)
{
	// The main viewport (owned by the application) will always have RendererUserData == 0 since we didn't create the data for it.
	ImGui_ImplCobra_Data* bd = ImGui_ImplCobra_GetBackendData();
	ImGui_ImplCobra_ViewportData* vd = (ImGui_ImplCobra_ViewportData*)viewport->RendererUserData;

	if (vd)
	{
		ImGui_ImplCobra_InitInfo* v = &bd->CobraInitInfo;
		IM_DELETE(vd);
	}

	viewport->RendererUserData = nullptr;
}

static void ImGui_ImplCobra_SetWindowSize(ImGuiViewport* viewport, ImVec2 size)
{
	ImGui_ImplCobra_Data* bd = ImGui_ImplCobra_GetBackendData();
	ImGui_ImplCobra_ViewportData* vd = (ImGui_ImplCobra_ViewportData*)viewport->RendererUserData;

	if (!vd) // Nullptr for the main viewport (users responsibility)
		return;

	ImGui_ImplCobraH_Window* wd = &vd->Window;
	Cobra::Swapchain& swapchain = *wd->Swapchain.get();
	swapchain.Resize({ (uint32_t)size.x, (uint32_t)size.y });
}

static void ImGui_ImplCobra_RenderWindow(ImGuiViewport* viewport, void*)
{
	ImGui_ImplCobra_Data* bd = ImGui_ImplCobra_GetBackendData();
	ImGui_ImplCobra_ViewportData* vd = (ImGui_ImplCobra_ViewportData*)viewport->RendererUserData;
	ImGui_ImplCobraH_Window* wd = &vd->Window;
	ImGui_ImplCobra_InitInfo* v = &bd->CobraInitInfo;

	Cobra::Swapchain& swapchain = *wd->Swapchain.get();
	Cobra::Queue& queue = *v->Queue;

	wd->FrameIndex = (wd->FrameIndex + 1) % 2;
	wd->SyncPoint[wd->FrameIndex].Wait();
	queue.Acquire(swapchain);

	auto cmd = queue.Begin();
	cmd.BeginRendering(swapchain.GetSize(), { swapchain.GetCurrent() });
	if (wd->ClearEnable)
		cmd.ClearColorAttachment(0, Cobra::Vec4{ 0.0f, 0.0f, 0.0f, 1.0f }, swapchain.GetSize());
	ImGui_ImplCobra_RenderDrawData(viewport->DrawData, cmd);
	cmd.EndRendering();

	cmd.Present(swapchain);
	wd->SyncPoint[wd->FrameIndex] = queue.Submit(cmd, {});
	queue.Present(swapchain, {});
}

bool ImGui_ImplCobra_CreateDeviceObjects()
{
	ImGui_ImplCobra_Data* bd = ImGui_ImplCobra_GetBackendData();
	ImGui_ImplCobra_InitInfo* v = &bd->CobraInitInfo;

	if (!bd->FontSampler)
		bd->FontSampler = std::make_unique<Cobra::Sampler>(*v->Context, Cobra::Filter::Linear, Cobra::Filter::Linear);

	bd->Shader = std::make_unique<Cobra::Shader>(*v->Context, SHADER_SPIRV);
	return true;
}

void ImGui_ImplCobra_InitPlatformInterface()
{
	ImGuiPlatformIO& platformIO = ImGui::GetPlatformIO();
	platformIO.Renderer_CreateWindow = ImGui_ImplCobra_CreateWindow;
	platformIO.Renderer_DestroyWindow = ImGui_ImplCobra_DestroyWindow;
	platformIO.Renderer_SetWindowSize = ImGui_ImplCobra_SetWindowSize;
	platformIO.Renderer_RenderWindow = ImGui_ImplCobra_RenderWindow;
	//platformIO.Renderer_SwapBuffers = [](ImGuiViewport* viewport, void*) {};
}

bool ImGui_ImplCobra_Init(ImGui_ImplCobra_InitInfo* info)
{
	ImGuiIO& io = ImGui::GetIO();
	IMGUI_CHECKVERSION();
	IM_ASSERT(io.BackendRendererUserData == nullptr && "Already initialized a renderer backend!");

	ImGui_ImplCobra_Data* bd = IM_NEW(ImGui_ImplCobra_Data);
	io.BackendRendererUserData = bd;
	io.BackendRendererName = "imgui_impl_cobra";
	io.BackendFlags |= ImGuiBackendFlags_RendererHasVtxOffset;
	io.BackendFlags |= ImGuiBackendFlags_RendererHasViewports;

	bd->CobraInitInfo = *info;
	ImGui_ImplCobra_CreateDeviceObjects();

	ImGuiViewport* mainViewport = ImGui::GetMainViewport();
	mainViewport->RendererUserData = IM_NEW(ImGui_ImplCobra_ViewportData)();

	if (io.ConfigFlags & ImGuiConfigFlags_ViewportsEnable)
		ImGui_ImplCobra_InitPlatformInterface();

	return true;
}

bool ImGui_ImplCobra_CreateFontsTexture()
{
	ImGuiIO& io = ImGui::GetIO();
	ImGui_ImplCobra_Data* bd = ImGui_ImplCobra_GetBackendData();
	ImGui_ImplCobra_InitInfo* v = &bd->CobraInitInfo;

	unsigned char* pixels;
	int width, height;
	io.Fonts->GetTexDataAsRGBA32(&pixels, &width, &height);

	bd->FontImage = std::make_unique<Cobra::Image>(*v->Context, Cobra::uVec2 { (uint32_t)width, (uint32_t)height }, Cobra::ImageFormat::R8G8B8A8_UNORM, Cobra::ImageUsage::Sampled | Cobra::ImageUsage::TransferDst);
	bd->FontImage->SetDebugName("Imgui font image");
	bd->FontImage->Set(pixels);
	bd->FontImage->Transition(Cobra::ImageLayout::ReadOnlyOptimal);
	
	io.Fonts->SetTexID((ImTextureID)(uint64_t)bd->FontImage->GetHandle());
	return true;
}

void ImGui_ImplCobra_NewFrame()
{
	ImGui_ImplCobra_Data* bd = ImGui_ImplCobra_GetBackendData();
	IM_ASSERT(bd != nullptr && "Context or backend not initialized! Did you call ImGui_ImplCobra_Init()?");

	if (!bd->FontImage)
		ImGui_ImplCobra_CreateFontsTexture();
}

void ImGui_ImplCobra_RenderDrawData(ImDrawData* drawData, Cobra::CommandList& cmd)
{
	int fbWidth = (int)(drawData->DisplaySize.x * drawData->FramebufferScale.x);
	int fbHeight = (int)(drawData->DisplaySize.y * drawData->FramebufferScale.y);
	if (fbWidth <= 0 || fbHeight <= 0) return;
	if (drawData->TotalVtxCount <= 0) return;

	ImGui_ImplCobra_Data* bd = ImGui_ImplCobra_GetBackendData();
	ImGui_ImplCobra_InitInfo* v = &bd->CobraInitInfo;

	ImGui_ImplCobra_ViewportData* viewportRendererData = (ImGui_ImplCobra_ViewportData*)drawData->OwnerViewport->RendererUserData;
	ImGui_ImplCobra_WindowRenderBuffers* wrb = &viewportRendererData->RenderBuffers;

	if (wrb->FrameRenderBuffers.empty())
	{
		wrb->Index = 0;
		wrb->Count = 2;

		wrb->FrameRenderBuffers.resize(wrb->Count);
		memset(wrb->FrameRenderBuffers.data(), 0, sizeof(ImGui_ImplCobra_FrameRenderBuffers) * wrb->Count);
	}

	wrb->Index = (wrb->Index + 1) % wrb->Count;
	ImGui_ImplCobra_FrameRenderBuffers* rb = &wrb->FrameRenderBuffers[wrb->Index];

	size_t vertexSize = drawData->TotalVtxCount * sizeof(ImDrawVert);
	size_t indexSize = drawData->TotalIdxCount * sizeof(ImDrawIdx);

	if (!rb->VertexBuffer || rb->VertexBuffer->GetSize() < vertexSize)
		rb->VertexBuffer = std::make_unique<Cobra::Buffer>(*v->Context, vertexSize, Cobra::BufferUsage::StorageBuffer, Cobra::BufferFlags::Mapped);
	if (!rb->IndexBuffer || rb->IndexBuffer->GetSize() < indexSize)
		rb->IndexBuffer = std::make_unique<Cobra::Buffer>(*v->Context, indexSize, Cobra::BufferUsage::IndexBuffer, Cobra::BufferFlags::Mapped);

	ImDrawVert* vtxDst = (ImDrawVert*)rb->VertexBuffer->GetHostAddress();
	ImDrawIdx* idxDst = (ImDrawIdx*)rb->IndexBuffer->GetHostAddress();

	for (int n = 0; n < drawData->CmdListsCount; n++)
	{
		const ImDrawList* cmdList = drawData->CmdLists[n];
		memcpy(vtxDst, cmdList->VtxBuffer.Data, cmdList->VtxBuffer.Size * sizeof(ImDrawVert));
		memcpy(idxDst, cmdList->IdxBuffer.Data, cmdList->IdxBuffer.Size * sizeof(ImDrawIdx));

		vtxDst += cmdList->VtxBuffer.Size;
		idxDst += cmdList->IdxBuffer.Size;
	}

	cmd.SetDefaultState();
	cmd.SetViewport({ fbWidth, fbHeight });
	cmd.EnableColorBlend(Cobra::BlendFactor::SrcAlpha, Cobra::BlendFactor::OneMinusSrcAlpha, Cobra::BlendOp::Add, Cobra::BlendFactor::One, Cobra::BlendFactor::Zero, Cobra::BlendOp::Add);
	cmd.BindIndexBuffer(*rb->IndexBuffer, sizeof(ImDrawIdx) == sizeof(uint16_t) ? Cobra::IndexType::Uint16 : Cobra::IndexType::Uint32);
	cmd.BindShaders({ *bd->Shader });

	Cobra::Vec2 scale = { 2.0f / drawData->DisplaySize.x, 2.0f / drawData->DisplaySize.y };
	Cobra::Vec2 translate = { -1.0f - drawData->DisplayPos.x * scale.x, -1.0f - drawData->DisplayPos.y * scale.y };

	ImVec2 clipOff = drawData->DisplayPos;
	ImVec2 clipScale = drawData->FramebufferScale;

	int globalVtxOffset = 0;
	int globalIdxOffset = 0;
	for (int n = 0; n < drawData->CmdListsCount; n++)
	{
		const ImDrawList* cmdList = drawData->CmdLists[n];
		for (int cmdi = 0; cmdi < cmdList->CmdBuffer.Size; cmdi++)
		{
			const ImDrawCmd* pcmd = &cmdList->CmdBuffer[cmdi];
			
			// Project scissor/clipping rectangles into framebuffer space
			ImVec2 clip_min((pcmd->ClipRect.x - clipOff.x) * clipScale.x, (pcmd->ClipRect.y - clipOff.y) * clipScale.y);
			ImVec2 clip_max((pcmd->ClipRect.z - clipOff.x) * clipScale.x, (pcmd->ClipRect.w - clipOff.y) * clipScale.y);

			// Clamp to viewport as vkCmdSetScissor() won't accept values that are off bounds
			if (clip_min.x < 0.0f) { clip_min.x = 0.0f; }
			if (clip_min.y < 0.0f) { clip_min.y = 0.0f; }
			if (clip_max.x > fbWidth) { clip_max.x = (float)fbWidth; }
			if (clip_max.y > fbHeight) { clip_max.y = (float)fbHeight; }
			if (clip_max.x <= clip_min.x || clip_max.y <= clip_min.y)
				continue;

			cmd.SetScissor({ int32_t(clip_max.x - clip_min.x), int32_t(clip_max.y - clip_min.y) }, { int32_t(clip_min.x), int32_t(clip_min.y) });
			cmd.PushConstant(Slang::DrawPush{
				.vertices = (Slang::Vertex*)rb->VertexBuffer->GetDeviceAddress(),
				.scale = scale,
				.translate = translate,
				.image = (uint32_t)(uint64_t)pcmd->TextureId | (bd->FontSampler->GetHandle() << 20)
			});
			cmd.DrawIndexed(pcmd->ElemCount, 1, pcmd->IdxOffset + globalIdxOffset, pcmd->VtxOffset + globalVtxOffset, 0);
		}

		globalVtxOffset += cmdList->VtxBuffer.Size;
		globalIdxOffset += cmdList->IdxBuffer.Size;
	}
}

void ImGui_ImplCobra_Shutdown()
{
	ImGui_ImplCobra_Data* bd = ImGui_ImplCobra_GetBackendData();
	IM_ASSERT(bd != nullptr && "No renderer backend to shutdown, or already shutdown?");
	ImGuiIO& io = ImGui::GetIO();
	ImGuiPlatformIO& platformIO = ImGui::GetPlatformIO();

	ImGuiViewport* mainViewport = ImGui::GetMainViewport();
	ImGui_ImplCobra_ViewportData* vd = (ImGui_ImplCobra_ViewportData*)mainViewport->RendererUserData;
	if (vd)
		IM_DELETE(vd);
	mainViewport->RendererUserData = nullptr;

	ImGui::DestroyPlatformWindows();

	io.BackendRendererName = nullptr;
	io.BackendRendererUserData = nullptr;
	io.BackendFlags &= ~(ImGuiBackendFlags_RendererHasVtxOffset | ImGuiBackendFlags_RendererHasViewports);
	IM_DELETE(bd);
}